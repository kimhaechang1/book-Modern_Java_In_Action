## 자바 7까지의 이야기...

초창기 자바는 스레드와 락, 그리고 메모리 모델까지 지원했다.

하지만 멀티 스레드 프로그래밍을 하기에는 불편했고

자바 5에서 제한된 스레드개수로 멀티 스레드 프로그래밍을 도와주는 스레드풀이 등장했다.

그기에다가 자바 7에서는 포크/조인 프레임워크를 제공하기 까지 했지만

여전히 개발자 입장에서 멀티 코어를 활용하는 프로그램을 하기 힘들었다.

## 자바 8

자바 8은 간결한 코드, 멀티 코어 프로세서의 쉬운 활용이라는 두 가지 요구사항을 기반으로 한다.

여기서 멀티 코어 프로세서라는건 여러 코어를 사용한다는 의미가 되고

여러 코어라는건 하나의 프로세서 즉 CPU내에 여러 코어로 이루어져 있는 칩셋을 의미한다.

자바 8의 주요 기능을 요약하자면 다음과 같다.

- Stream API
- 메서드에 코드를 전달하는 기법
- 인터페이스의 디폴트 메서드

여기서 Stream API 때문에 메서드에 코드를 전달하는 기법이 생겼다고 생각하면 활용성을 제한시키는 위험한 생각이다.

메서드에 코드를 전달하는 기법으로 `동작의 파라미터화`를 좀 더 간결한 코드로 구현할 수 있다.

이러한 자바 8은 함수형 프로그래밍에서 위력을 발휘한다.

## 왜 멀티코어에서 synchronized는 비용이 비쌀까?

synchronized는 락을 통해 스레드의 경합을 해결한다.

멀티코어에서는 각 코어가 자신만의 캐시 메모리를 갖고서 공유 메모리상의 데이터에 대한 빠른 접근이 가능한데

synchronized를 사용하게 되면 데이터를 일관성있게 유지하기 위해서 공유 메모리가 수정될때 마다 모든 코어의 캐시를 동기화 하는 문제가 발생한다.

이로인해 일관성을 강력하게 유지할 수는 있지만, 비용이 터무니없이 크다.

## 스트림 처리

스트림이란 한번에 한개씩 만들어지는 연속적인 데이터항목들의 모임을 뜻한다.

예를들어서 데이터는 하나씩 들어가지만,

각각의 처리해야하는 부분 즉, 처리라인들은 독립적으로 실행된다.

그래서 하나씩 처리되는것 처럼 보이지만

각 처라라인들은 이전 처리라인이 모든 입력을 처리하기까지 대기하는것이 아니다.

## 동작 파라미터화

동작을 파라미터화 한다는 것은 결국 해당 메서드의 구체적인 동작을 외부에서 결정한다는 것이 된다.

기존에 자바 8 이전에도 익명 구현 객체를 통해 동작의 파라미터화를 구현하던가

또 다른 구현 클래스를 만들어서 구현해야 하였다.

하지만 이는 동작을 단순화하여 재활용하기에는 좋지 않다.

그래서 메서드의 인자로 코드를 넣을 수 있는 방법을 도입하게 된다.

## 병렬성과 공유 가변 데이터

병렬성을 공짜로 얻기위해서 무언가를 포기해야 한다고 하였는데

여기서 포기하는 무언가는 공유된 가변 데이터를 뜻한다.

공유된 가변 데이터는 말뜻 그대로 둘 이상의 함수가 참조하면서, 변경가능성이 열려 있는 데이터를 말한다.

즉, 병렬성을 공짜로 얻기 위해서는 동작하는 함수들이 부수효과를 일으키지 않는 순수함수여야 한다는 말이다.

이러한 순수함수와 함수 코드를 다른 메서드의 인자로 넘기는 방식은 함수형 프로그래밍 패러다임의 핵심적인 내용이 된다.

### 함수형 프로그래밍

https://mangkyu.tistory.com/111

함수형 프로그래밍은 선언형 프로그래밍을 뜻하며

선언형 프로그래밍은 어떻게 보다는 무엇을 할건지를 설명하는 방식을 뜻한다.

함수형 프로그래밍의 특징은

부수효과가 없는 순수 함수를 1급 객체로 간주하여 파라미터나 반환값으로 사용할 수 있으며, 참조 투명성을 지킬 수 있다. 라고 되어있다.

함수형 프로그래밍을 설명하기 위해서는 "부수효과", "순수 함수", "1급 객체", "참조 투명성" 키워드를 이해해야 한다.

### 부수효과

부수효과는 변화 또는 변화를 발생시키는 작업을 뜻한다.

아주 간단하게 보자면

```java
int a = 10;

public void discount(){
    a--;
}

discount(); // 값이 변경됨
```

위는 공유변수 a의 값에 영향을 주게 되는것으로 부수효과를 지닌 함수가 된다.

그것 밖에도 예외나 오류가 발생할 수 있다거나,
함수 호출 시 콘솔 또는 파일 I/O가 발생하는 경우도 부수효과가 있다고 말할 수 있다.

### 순수 함수

위와 같은 부수 효과를 제거한 함수들을 순수함수 라고 하며

요약하자면 외부에 영향을 주지 않는 함수를 뜻한다.

### 1급 객체

변수나 데이터 구조안에 담을 수 있고, 파라미터로 전달할 수 있으며, 반환값으로 사용할 수 있다면 1급 객체로 분류한다.

### 참조 투명성

동일한 인자가 주어졌을 시, 항상 동일한 결과를 반환 해야 한다.

참조 투명성을 통해 기존의 값은 변경되지 않고 유지된다.

정리하자면

"함수형 프로그래밍은 외부의 값을 변경하거나 등의 사이드 효과를 없에고, 동일한 인자를 제공할시 언제나 같은 값을 반환하는 함수를 1급객체로 간주하여 파라미터나 반환값으로 사용할 수 있다" 라고 해석할 수 있다.

결국 StreamAPI가 병렬성을 공짜로 가지기 위해서 포기 해야하는 것은 동작을 참조 투명성을 가진 순수 함수로 만들어야 함을 의미한다.

왜냐하면 병렬 프로그래밍을 하는데 있어서 공유자원에 접근할 일이 생긴다면, 동기화 문제를 또 해결해야 하기 때문이다.

## 자바의 함수

프로그래밍언어에서 함수라는 용어는 정적 메서드와 같은 의미로 해석된다.

자바의 함수는 순수함수이기 때문에 수학적인 함수로 언제나 같은 값을 반환한다.

그리고 자바의 함수는 값으로 취급 될 수 있다.

따라서 자바의 메서드는 2급 취급이지만, 이를 1급으로 만들어 주는 것을 제공함으로서 일급 객체를 사용하게 된다.
